<!DOCTYPE html>
<head>
    <title>Project 3: </title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            margin: 0 auto;
            max-width: 960px;
            padding: 20px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .gallery-item {
            text-align: center;
        }

        .gallery-item img {
            width: 80%;
            height: 70%; 
            object-fit: cover;
            border-radius: 5px;
            background-color: #eee;
        }

        .gallery-item p {
            margin-top: 5px;
            font-size: 1em;
            color: #6c6464;
        }

        h1, h2, h3, h4 {
            color: #333;
            text-align: center;
        }

        ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        li {
            margin-bottom: 10px;
        }

        .button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #101256;
            color: white;
            transition: background-color 0.3s ease;
        }
        
        .button:hover {
            background-color: #63dac4;
        }

        .imagesTwo img {
            width: 45%;
            height: 45%;
            object-fit: cover;
            align-items: center;
        }

        .images img {
            width: 90%;
            height: auto;
            object-fit: cover;
            align-items: center;
        }
        
    </style>
</head>
<body>
    <a href="../index.html">
        <button class="button">home</button>
    </a>
    <h1>Project 3: [Auto]Stitching Photo Mosaics!</h1>
    <hr>

    <h2>Part 1: IMAGE WARPING and MOSAICING</h2>

    <h3>A.1: Shoot the Pictures</h3>
    <p> I took sets of images with projective transformations. This is done through keeping the center of projection the same and rotating the camera. </p>
    <div class="imagesTwo">
        <img src="web/result/a.1_mainstacksmiddle.jpg" alt="1.1">
        <img src="web/result/a.1_mainstacksright.jpg" alt="2.2">
    </div>

    <div class="imagesTwo">
        <img src="web/result/a.1_venice_middle.jpg" alt="1.1">
        <img src="web/result/a.1_venice_right.jpg" alt="2.2">
    </div>

    <div class="imagesTwo">
        <img src="web/result/a.1_zeller_left.jpg" alt="1.1">
        <img src="web/result/a.1_zeller_right.jpg" alt="2.2">
    </div>
    
    <h3>A.2: Recover Homographies </h3>
    <div class="imagesTwo">
        <img src="web/result/a.2_mainstackmiddle.png" alt="1.2">
        <img src="web/result/a.2_mainstackright.png" alt="1.2">
    </div>

    <p> For each correspondence point pair (x, y) → (x', y'), I set up two equations: A contains the coefficients based on (x, y) coordinates, and b contains the target coordinates (x', y'). The system Ah = b is solved with least squares to obtain the H. The general system of equation is: </p>
    <div class="images">
        <img src="web/result/a.2_general_equation.png" alt="1.2">
    </div>
    <div class="images">
        <p> Recovered homography H for mainstack</p>
        <img src="web/result/a.2_equation.png" alt="1.2">
    </div>

    <p>Correspondents for other images:</p>

    <div class="imagesTwo">
        <img src="web/result/a.2_venice_left.png" alt="1.2">
        <img src="web/result/a.2_venice_right.png" alt="1.2">
    </div>

      <div class="imagesTwo">
        <img src="web/result/a.2_zeller_left.png" alt="1.2">
        <img src="web/result/a.2_zeller_right.png" alt="1.2">
    </div>

    <h3>A.3: Warp the Images</h3>
    <p> For Nearest Neighbor Interpolation, I rounded coordinates to the nearest pixel value while for Bilinear Interpolation I used weighted average of four neighboring pixels. The results are pretty similar. However Bilinear Interpolation took longer than Nearest Neighbor Interpolation to process. </p>
    <div class="images">
        <img src="web/result/a.3_whiteboard.png" alt="1.3">
    </div>

    <div class="images">
        <img src="web/result/a.3_poster.png" alt="1.3">
    </div>

    <h3>A.4: Blend the Images into a Mosaic </h3>
    <p> To create a blended image mosaic, I first computed the homography between the images using corresponding points and determined the full canvas size to fit all of them. I applied an offset to handle negative coordinates and warped the second image into the canvas while keeping the first image unwarped. For blending, I created masks for valid pixels in each image using weighted averaging. For overlapping pixels, I computed a weighted sum of their values divided by the sum of the weights, while non-overlapping pixels retained their original values. This allowed me to achieve a smoother transition between images. </p>
    <div class="images">
        <img src="web/result/a.4_mainstack.png" alt="1.3">
    </div>

    <div class="images">
        <img src="web/result/a.4_venice.png" alt="1.3">
    </div>

    <div class="images">
        <img src="web/result/a.4_zeller.png" alt="1.3">
    </div>
    
    <h2>Part 2: FEATURE MATCHING for AUTOSTITCHING</h2>

    <h3>B.1: Harris Corner Detection</h3>
    <p> I started by using the provided get_harris_corners function to calculate the harris corners. After getting all the raw Harris corners, I implemented ANMS to keep only the most spatially distinct points. My first attempt used all ~150k corners, which would run out of memory and crash my computer. To fix this, I added a filtering step by increasing the threshold to reduce the number of initial corners before ANMS. </p>
    <div class="imagesTwo">
        <img src="web/result/b.1_harris.png" alt="1.2">
        <img src="web/result/b.1_ANMS.png" alt="1.2">
    </div>

    <h3>B.2: Feature Descriptor Extraction</h3>
    <p> Once I had my set of corners, I extracted feature descriptors centered at each one. For each corner, I made sure that the 40×40 window is within the image bounds and then used cv2.resize to downsample each patch to an 8×8 descriptor. Each descriptor was also bias/gain normalized through subtracting its mean and dividing by its standard deviation. This normalization allows us to match across different images. I visualized some of these descriptors in 8×8 grayscale below. </p>
    <div class="images">
        <img src="web/result/b.2.png" alt="1.2">
    </div>

    <h3>B.3: Feature Matching</h3>
    <p> For feature matching, I implemented the nearest-neighbor ratio test. I first computed all pairwise Euclidean distances between the descriptors of image 1 and image 2. For each descriptor in image 1, I sorted the distances to all descriptors in image 2 to find the closest and second-closest matches. Then I computed the Lowe ratio and if it was below my threshold (0.8), I kept the match. This helps filter out ambiguous matches. I visualized the resulting matches below by plotting lines connecting corresponding marches across the two images. </p>
    <div class="images">
        <img src="web/result/b.3.png" alt="1.2">
    </div>

    <h3>B.4: RANSAC for Robust Homography</h3>
    <p> I used RANSAC to determine outliers and improve the alignment:</p>
    <li> Randomly sample 4 correspondences to compute a candidate homography H.</li>
    <li> Apply H to all points from image 1 and compute the reprojection error to points in image 2.</li>
    <li> Find inliers whose reprojection error is below the threshold (5 pixels).</li>
    <li> Repeat 1000 iterations and keep the H with the most inliers.</li>
    <p> Then I used this to warp one image into the coordinates of the other to stitch them together. Some mask seams were still visible due to brightness differences from when the pictures were taken, but the alignment is more accurate and has less ghosting than the manual alignment. I was also able to get a smoother result through blending the edges of the masks with laplacian stacks.</p>
    <h4> Manual Alignment vs Auto Alignment<h4>
    <div class="imagesTwo">
        <img src="web/result/a.4_mainstack.png" alt="1.2">
        <img src="web/result/b.4_main.png" alt="1.2">
    </div>
    <div class="imagesTwo">
        <img src="web/result/a.4_venice.png" alt="1.2">
        <img src="web/result/b.4_venice.png" alt="1.2">
    </div>

    <div class="imagesTwo">
        <img src="web/result/a.4_zeller.png" alt="1.2">
        <img src="web/result/b.4_zeller.png" alt="1.2">
    </div>
    <hr>
</body>
</html>
