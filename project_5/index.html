<!DOCTYPE html>
<head>
    <title>Project 5 </title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            margin: 0 auto;
            max-width: 960px;
            padding: 20px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .gallery-item {
            text-align: center;
        }

        .gallery-item img {
            width: 80%;
            height: 70%; 
            object-fit: cover;
            border-radius: 5px;
            background-color: #eee;
        }

        .gallery-item p {
            margin-top: 5px;
            font-size: 1em;
            color: #6c6464;
        }

        h1, h2, h3, h4 {
            color: #333;
            text-align: center;
        }

        ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        li {
            margin-bottom: 10px;
        }

        .button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #101256;
            color: white;
            transition: background-color 0.3s ease;
        }
        
        .button:hover {
            background-color: #63dac4;
        }

        .imagesTwo img {
            width: 45%;
            height: 45%;
            object-fit: cover;
            align-items: center;
        }

        .images img {
            width: 90%;
            height: auto;
            object-fit: cover;
            align-items: center;
        }
                
        .horizontal-scroll-gallery {
            display: flex;       
            overflow-x: auto;  
            width: 100%;        
        }
        
        .scroll-gallery-item {
            flex: 0 0 auto;    
            text-align: center; 
            margin: 0;           
            padding: 0;          
        }

        .scroll-gallery-item p {
            font-size: 0.8em;    
            color: #6c6464;       
            margin: 0 2px 5px 2px; 
        }

        .scroll-gallery-item img {
            height: 150px;       
            width: auto;         
            display: block;      
        }
        
    </style>
</head>
<body>
    <a href="../index.html">
        <button class="button">home</button>
    </a>
    <h1>Project 5: Fun With Diffusion Models!</h1>
    <hr>

    <h2>Part 0: Setup</h2>
    <p> Below are the prompts I came up with for the diffusion model:
        a high quality picture
        an oil painting of UC Berkeley's campanile
        a photo of the golden gate bridge 
        a photo of an octopus making coffee
        a photo of half eaten apple
        a photo of a couple facing each other 
        an oil painting of a red lamp
        an oil painting of a red mushroom
        a lithograph of the moon
        a lithograph of the sun
        a high quality photo
        a cute dog 
        a cute cat
    </p>
    <p> I used the seed of 180 and set num_inferences to 20 to get the images below:</p>
    <div class="images">
        <img src="web_a/0.png" alt="1.1">
    </div>
    <p> Then I tried changing the num_inferences to 100 and got the results below. It seems that increasing the num_inferences makes the images follow more of the prompt, as the octopus is actually making coffee instead of holding it.  </p>
    <div class="images">
        <img src="web_a/0.1.png" alt="1.1">
    </div>

    <h2>Part 1: Sampling Loops</h2>
    <h3> 1.1 Implementing the Forward Process </h3>
    <div class="images">
        <img src="web_a/1.1.png" alt="1.3">
    </div>
    <h3> 1.2 Classical Denoising </h3>
    <div class="images">
        <img src="web_a/1.2.png" alt="1.3">
    </div>
    <h3> 1.3 One-Step Denoising </h3>
    <div class="images">
        <img src="web_a/1.3.1.png" alt="1.3">
        <img src="web_a/1.3.2.png" alt="1.3">
        <img src="web_a/1.3.3.png" alt="1.3">
    </div>

    <h3> 1.4 Iterative Denoising </h3>
    <div class="horizontal-scroll-gallery">
        <img src="web_a/1.4.1.png" alt="1.3">
        <img src="web_a/1.4.2.png" alt="1.3">
        <img src="web_a/1.4.3.png" alt="1.3">
        <img src="web_a/1.4.4.png" alt="1.3">
        <img src="web_a/1.4.5.png" alt="1.3">
        <img src="web_a/1.4.6.png" alt="1.3">
    </div>
    <div class="images">
        <img src="web_a/1.4.7.png" alt="1.3">
    </div>
    
    <h3> 1.5 Diffusion Model Sampling </h3>
    <div class="images">
        <img src="web_a/1.5.png" alt="1.5.1">
    </div>

    <h3> 1.6 Classifier-Free Guidance (CFG) </h3>
    <div class="images">
        <img src="web_a/1.6.png" alt="1.6.1">
    </div>

    <h3> 1.7 Image-to-image Translation </h3>
    <div class="images">
        <img src="web_a/1.7.0.img2img.png" alt="1.7.1">
        <img src="web_a/1.7.0.img2img1.png" alt="1.7.1">
        <img src="web_a/1.7.0.img2img2.png" alt="1.7.1">
    </div>

    <h3> 1.7.1 Editing Hand-Drawn and Web Images </h3>
    <div class="horizontal-scroll-gallery">
        <img src="web_a/1.7.1_handdrawn_ref1.png" alt="1.7.1">
        <img src="web_a/1.7.1_handdrawn_ref1_result.png" alt="1.7.1">
    </div>
    <div class="horizontal-scroll-gallery">
        <img src="web_a/1.7.1_handdrawn_ref2.png" alt="1.7.1">
        <img src="web_a/1.7.1_handdrawn_ref2_result.png" alt="1.7.1">
    </div>
    <div class="images">
        <img src="web_a/1.7.1_web.png" alt="1.7.1">
    </div>

    <h3> 1.7.2 Inpainting </h3>
    <div class="images">
        <img src="web_a/1.7.2.png" alt="1.7.2">
        <img src="web_a/1.7.2.custom1.png" alt="1.7.2">
        <img src="web_a/1.7.2.custom2.png" alt="1.7.2">
    </div>

    <h3> 1.7.3 Text-Conditional Image-to-image Translation </h3>
    <div class="images">
        <p> From "a photo of half eaten apple" to the campanile</p>
        <img src="web_a/1.7.3_campnile.png" alt="1.7.2">
        <p> From "an oil painting of a red mushroom" to the cake</p>
        <img src="web_a/1.7.3_cake.png" alt="1.7.2">
        <p> From "a lithograph of the moon" to the witch</p>
        <img src="web_a/1.7.3_moon.png" alt="1.7.2">
    </div>

     <h3> 1.8 Visual Anagrams </h3>
    <div class="images">
        <p> "a photo of half eaten apple" and "a photo of a couple facing each other"</p>
        <img src="web_a/1.8_apple.png" alt="1.7.2">
        <p> "a cute dog" and "a cute cat"</p>
        <img src="web_a/1.8_dog_cat.png" alt="1.7.2">
    </div>

     <h3> 1.9 Hybrid Images </h3>
    <div class="imagesTwo">
        <p> "a cute dog" and "a cute cat"</p>
        <img src="web_a/1.9.1.png" alt="1.7.2">
        <p> "an oil painting of a red mushroom" and "a photo of a couple facing each other"</p>
        <img src="web_a/1.9.3.png" alt="1.7.2">
    </div>
    
    <h2>Part B: Flow Matching from Scratch!</h2>

    <h3> Part 1: Training a Single-Step Denoising UNet</h3>
    
    <h3> 1.1  Implementing the UNet </h3>
    <p> I implemented the denoiser as a UNet following the architecture below:</p>
    <div class="images">
        <img src="web_b/1.1.1.png" alt="1.2">
        <img src="web_b/1.1.2.png" alt="1.2">
    </div>

    <h3> 1.2 Using the UNet to Train a Denoiser </h3>
    <div class="images">
        <img src="web_b/1.2.0.png" alt="1.2">
    </div>

    <h3> 1.2.1 Training</h3>
    <div class="imagesTwo">
        <img src="web_b/1.2.1_1_epoch.png" alt="1.2">
        <img src="web_b/1.2.1_5_epoch.png" alt="1.2">
    </div>
    <div class="images">
        <img src="web_b/1.2.1_training_curve.png" alt="1.2">
    </div>

    <h3> 1.2.2 Out-of-Distribution Testing </h3>
    <div class="images">
        <img src="web_b/1.2.2.png" alt="1.2">
        <img src="web_b/1.2.2.1.png" alt="1.2">
        <img src="web_b/1.2.2.2.png" alt="1.2">
        <img src="web_b/1.2.2.3.png" alt="1.2">
    </div>

    <h3> 1.2.3 Denoising Pure Noise </h3>
     <div class="imagesTwo">
        <img src="web_b/1.2.3_1_epoch.png" alt="1.2">
        <img src="web_b/1.2.3_5_epoch.png" alt="1.2">
    </div>
    <div class="images">
        <img src="web_b/1.2.3_training_curve.png" alt="1.2">
    </div>

    <h3> Part 2: Training a Flow Matching Model</h3>

    <h3> 2.1 Adding Time Conditioning to UNet </h3>
    <p> We need a way to inject scalar into our UNet model to condition it. We're predicting the flow from the noisy to clean, which will contain both parts of the original image as well as the noise to remove. This uses a new operator called FCBlock (fully-connected block) which we use to inject the conditioning signal into the UNet: </p>
    <div class="images">
        <img src="web_b/2.1.1.png" alt="1.2">
        <img src="web_b/2.1.2.png" alt="1.2">
    </div>

    <h3> 2.2 Training the UNet</h3>
    <div class="images">
        <img src="web_b/2.2_curve.png" alt="1.2">
    </div>

    <h3> 2.3 Sampling from the UNet</h3>
    <div class="images">
        <img src="web_b/2.3.1.png" alt="1.2">
        <img src="web_b/2.3.2.png" alt="1.2">
        <img src="web_b/2.3.3.png" alt="1.2">
    </div>

    <h3> 2.4 Adding Class-Conditioning to UNet</h3>
    <div class="images">
        <img src="web_b/2.4.png" alt="1.2">
    </div>

    <h3> 2.5 Training the UNet</h3>
    <div class="images">
        <img src="web_b/2.5.png" alt="1.2">
    </div>

    <h3> 2.6 Sampling from the UNet</h3>
    <p> </p>
    <div class="images">
        <img src="web_b/2.6.1_scheduler_1.png" alt="1.2">
        <img src="web_b/2.6.1_scheduler_2.png" alt="1.2">
        <img src="web_b/2.6.1_scheduler_3.png" alt="1.2">
    </div>

    <p> without scheduler </p>
    <div class="images">
        <img src="web_b/2.6.1_no_scheduler_1.png" alt="1.2">
        <img src="web_b/2.6.1_no_scheduler_2.png" alt="1.2">
        <img src="web_b/2.6.1_no_scheduler_3.png" alt="1.2">
    </div>
    <hr>
</body>
</html>
